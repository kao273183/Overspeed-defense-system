# 🚗 防扣牌預警系統 (Overspeed Defense System)

一個專為駕駛設計的 Web-based GPS 測速與預警系統。
專注於防止「嚴重超速」（扣牌）的風險，具備 CarPlay 音訊通道鎖定、子母畫面 (PiP) 支援以及高度客製化的警示功能。

## ✨ 主要功能

### 🎯 核心測速與警示
* **精準 GPS 測速**：使用手機高精度 GPS 訊號計算即時時速。
* **三段式視覺警示**：
    * 🟢 **綠色 (安全)**：低於預警門檻。
    * 🟡 **黃色 (預警區)**：接近扣牌門檻前 5 公里 (速限 + 33km/h)。
    * 🔴 **紅色 (危險區)**：達到扣牌門檻 (速限 + 38km/h)，背景紅燈閃爍。
* **OSM 自動速限**：整合 OpenStreetMap (Overpass API)，自動抓取當前路段速限（亦可手動調整）。

### 🔊 智慧音效系統 (CarPlay 優化)
* **CarPlay/藍芽相容**：內建靜音音軌 (Silent Track)，確保在 iOS Safari 或連線車機時，警示音不會被系統休眠或中斷。
* **雙重警示邏輯**：
    * **黃區**：播放短促警示音效（嗶嗶聲）。
    * **紅區**：播放警示音效 + TTS 語音播報（例如：「嚴重超速！請煞車」）。
* **高度客製化**：
    * 可上傳自訂 **MP3** 警示音效（預設為高頻嗶聲）。
    * 可自訂 **TTS 語音** 播報內容。

### 📺 使用者介面 (UI/UX)
* **極簡駕駛模式**：主畫面僅保留超大時速表、限速設定與啟動按鈕，避免分心。
* **子母畫面 (PiP) 支援**：利用 Canvas 繪製技術，將時速表偽裝成影片訊號。允許在使用 Google Maps 或其他導航 App 時，懸浮顯示時速與警示燈號。
* **漢堡選單設定**：將複雜設定（上傳音效、測試按鈕、開關 OSM）收納至側邊欄。
* **快捷操作**：
    * 頂部快捷鍵：快速切換 `30` / `40` / `50` km/h。
    * 左右微調鈕：`+5` / `-5` km/h 快速調整。

---

## 🚀 如何使用

1.  **開啟網頁**：建議使用 Safari (iOS) 或 Chrome (Android)。
2.  **設定速限**：
    * 系統預設速限為 **50 km/h**。
    * 可透過快捷鍵或微調按鈕修改，或勾選「OSM 自動速限」。
3.  **啟動監控**：
    * **務必點擊主畫面的「🚀 啟動監控」按鈕**。
    * 系統會播放一聲測試音以喚醒音訊通道，並語音播報「偵測開始」。
    * *注意：若未點擊啟動，GPS 與音效將不會運作。*
4.  **背景執行 / 子母畫面**：
    * 點擊左上角漢堡選單 (☰) -> 點擊「📺 開啟子母畫面」。
    * 此時可切換至導航軟體，時速表將以懸浮視窗顯示。

---

## 📂 檔案結構

* `index.html`: 專案核心代碼 (HTML/CSS/JS)。
* `sound.mp3`: (選用) 預設的警示音效檔。若無此檔案，系統會自動生成電子嗶聲。

---

## 🛠️ 技術細節

* **Geolocation API**: 獲取 GPS 位置、速度與精確度。
* **Web Audio API & Audio Element**: 處理背景音訊與即時音效生成。
* **SpeechSynthesis (TTS)**: 瀏覽器原生文字轉語音功能。
* **OpenStreetMap (Overpass API)**: 即時查詢附近道路速限資料。
* **Canvas & Picture-in-Picture API**: 實作動態繪圖與子母畫面功能。

---

## ⚠️ 注意事項

1.  **HTTPS 限制**：瀏覽器要求 GPS 定位與子母畫面功能必須在 **HTTPS** 環境下才能運作 (GitHub Pages 預設支援)。
2.  **iOS 限制**：iPhone 使用者請務必關閉靜音模式，並確保螢幕保持喚醒（系統內建 Wake Lock API 支援）。
3.  **安全免責**：本系統僅供輔助參考，GPS 速度可能因訊號遮蔽而有延遲或誤差，駕駛人應以儀表板與實際路況為準。

---

## 📝 授權

MIT License
